{"version":3,"sources":["file:///D:/CODE/cocos_workspace/%E8%83%8C%E5%8C%85%E8%8B%B1%E9%9B%84/assets/Scripts/Game/Weapon/WeaponBgItem.ts"],"names":["_decorator","instantiate","Layout","Sprite","UIOpacity","UITransform","v2","Vec3","GameEvent","EventListener","ResourcesUtil","BaseComponent","WeaponData","GridData","GridObj","Constants","ccclass","property","WeaponBgItem","_touchStatus","_weaponKey","_weaponCfg","_point","_pointGridObj","_placeStatus","_isTouch","point","weaponCfg","weaponKey","placeStatus","value","init","node","getChildByName","initWeaponSize","setPointPosArr","setGridIcon","setNodeAngel","typeArr","Type","split","rowLen","Number","colLen","size","instance","getGridSizeByRowCol","scale","iconScale","getComponent","setContentSize","setPosition","width","height","icon","setScale","Points","i","length","item","j","element","gridObj","row","col","push","path","weaponIconPath","Res","getSpriteFrame","then","frame","spriteFrame","iconList","parent","row_col","latticePoints","spacingX","space","spacingY","updateLayout","active","opacity","angle","onGridRemove","id","emit","ADD_REMOVE_WEAPON_LIST","onPlaceFinish","PLACE_GRID_END","onTouchStart","wpos","touchPos","convertToNodeSpaceAR","x","y","checkPointinGrid","isSelect","TouchStatus","START","PLACE_GRID_START","pos","onTouchMove","MOVE","PLACE_GRID_MOVE","onTouchEnd","END","onTouchCancle","CANCEL","onEnable","on","GAME_TOUCH_START","GAME_TOUCH_MOVE","GAME_TOUCH_END","GAME_TOUCH_CANCLE","onDisable","off"],"mappings":"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","sourcesContent":["import { _decorator, Color, instantiate, Layout, Node, Sprite, SpriteFrame, Tween, tween, UIOpacity, UITransform, v2, v3, Vec2, Vec3 } from 'cc';\r\nimport { GameEvent } from '../Event/GameEvent';\r\nimport { EventListener } from '../../Frame/EventListener';\r\nimport { ResourcesUtil } from '../../Frame/ResourcesUtil';\r\nimport BaseComponent from '../../Frame/BaseComponent';\r\nimport { WeaponData } from '../Data/WeaponData';\r\nimport { WeaponCfg } from '../../Model/WeaponModel';\r\nimport { GridData, GridObj } from '../Data/GridData';\r\nimport { Constants } from '../../Constants';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('WeaponItem')\r\nexport class WeaponBgItem extends BaseComponent {\r\n    @property(Sprite)\r\n    icon: Sprite = null;\r\n\r\n    private _touchStatus: number = 0;//当前触摸状态\r\n    private _weaponKey: string = '';//唯一值\r\n    private _weaponCfg: WeaponCfg = null;\r\n    private _point: Node = null;\r\n    private _pointGridObj: Array<GridObj> = [];//占用点位置\r\n\r\n    private _placeStatus: boolean = true; //true:放置  false:卸下\r\n    private _isTouch: boolean = false;//是否被点击\r\n\r\n    get point() {\r\n        return this._point;\r\n    }\r\n\r\n    get weaponCfg() {\r\n        return this._weaponCfg;\r\n    }\r\n\r\n    get weaponKey() {\r\n        return this._weaponKey;\r\n    }\r\n\r\n    set placeStatus(value: boolean) {\r\n        this._placeStatus = value;\r\n    }\r\n\r\n    init(weaponCfg: WeaponCfg, weaponKey: string, placeStatus: boolean) {\r\n        this._pointGridObj = [];\r\n        this._placeStatus = placeStatus;\r\n        this._weaponKey = weaponKey;\r\n        this._weaponCfg = weaponCfg;\r\n        this._point = this.node.getChildByName('point');\r\n        this.initWeaponSize();\r\n        this.setPointPosArr();\r\n        this.setGridIcon();\r\n        this.setNodeAngel();\r\n    }\r\n\r\n    /* 初始武器格子尺寸 */\r\n    initWeaponSize() {\r\n        let typeArr = this._weaponCfg.Type.split('_');\r\n        let rowLen = Number(typeArr[1]);\r\n        let colLen = Number(typeArr[0]);\r\n        let size = GridData.instance.getGridSizeByRowCol(rowLen, colLen);\r\n        let scale = GridData.instance.iconScale;\r\n        this.node.getComponent(UITransform).setContentSize(size);\r\n        this.point.setPosition(-size.width / 2, size.height / 2);\r\n        this.icon.node.setScale(scale, scale, scale);\r\n    }\r\n\r\n    /* 设置点坐标 */\r\n    setPointPosArr() {\r\n        this._pointGridObj = [];\r\n        let point = this._weaponCfg.Points;\r\n        for (let i = 0; i < point.length; i++) {\r\n            const item = point[i];\r\n            for (let j = 0; j < item.length; j++) {\r\n                const element = item[j];\r\n                if (element) {\r\n                    let gridObj = new GridObj();\r\n                    gridObj.row = i;\r\n                    gridObj.col = j;\r\n                    this._pointGridObj.push(gridObj);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* 设置武器图标 */\r\n    setGridIcon() {\r\n        let path = Constants.weaponIconPath + this.weaponCfg.Res + '/spriteFrame';\r\n        ResourcesUtil.getSpriteFrame(path).then((frame: SpriteFrame) => {\r\n            this.icon.spriteFrame = frame;\r\n            //设置格子\r\n            let iconList = this.icon.node.parent;\r\n            let row_col = this.weaponCfg.Type.split('_');\r\n            let size = GridData.instance.getGridSizeByRowCol(Number(row_col[1]), Number(row_col[0]));\r\n            let latticePoints = this.weaponCfg.Points;\r\n            iconList.getComponent(Layout).spacingX = GridData.instance.space;\r\n            iconList.getComponent(Layout).spacingY = GridData.instance.space;\r\n            iconList.getComponent(UITransform).width = size.width;\r\n            iconList.getComponent(Layout).updateLayout(true);\r\n            for (let i = 0; i < latticePoints.length; i++) {\r\n                const element = latticePoints[i];\r\n                for (let j = 0; j < element.length; j++) {\r\n                    const value = element[j];\r\n                    let item = instantiate(this.icon.node);\r\n                    item.active = true;\r\n                    item.parent = iconList;\r\n                    item.getComponent(UIOpacity).opacity = value ? 255 : 0;\r\n                }\r\n\r\n            }\r\n        })\r\n    }\r\n\r\n    setNodeAngel() {\r\n        let angle = this._placeStatus ? 0 : 10;\r\n        this.node.angle = angle;\r\n    }\r\n\r\n    /* 格子卸下 */\r\n    onGridRemove(id: string) {\r\n        if (this.weaponKey == id) {\r\n            //添加到待上阵武器列表\r\n            EventListener.emit(GameEvent.ADD_REMOVE_WEAPON_LIST, this.node);\r\n            this.placeStatus = false;\r\n            this.setNodeAngel();\r\n        }\r\n    }\r\n\r\n\r\n    /* 放置完成 */\r\n    onPlaceFinish() {\r\n        // 放置完成时触发属性更新事件\r\n        // EventListener.emit(GameEvent.WEAPON_PLACE, this._weaponCfg); // 传递当前武器配置\r\n        //放置完成\r\n        EventListener.emit(GameEvent.PLACE_GRID_END, this);\r\n    }\r\n\r\n\r\n    /* 关闭多触碰 */\r\n    /* 触摸点击 */\r\n    onTouchStart(wpos: Vec2) {\r\n        //是否触摸到武器(只能选中一个)\r\n        let touchPos = this.point.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(wpos.x, wpos.y, 0));\r\n        if (GridData.instance.checkPointinGrid(v2(touchPos.x, touchPos.y), this._pointGridObj) && !WeaponData.instance.isSelect) {\r\n            this._isTouch = true;\r\n            WeaponData.instance.isSelect = true;\r\n            this._touchStatus = TouchStatus.START;\r\n            //编辑格子\r\n            this.placeStatus = true;\r\n            this.setNodeAngel();\r\n            EventListener.emit(GameEvent.PLACE_GRID_START, this);\r\n            \r\n            let pos = this.node.parent.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(wpos.x, wpos.y, 0));\r\n            this.node.setPosition(pos.x, pos.y);\r\n        }\r\n    }\r\n\r\n    onTouchMove(wpos: Vec2) {\r\n        if (this._isTouch) {\r\n            this._touchStatus = TouchStatus.MOVE;\r\n            let pos = this.node.parent.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(wpos.x, wpos.y, 0));\r\n            this.node.setPosition(pos.x, pos.y);\r\n            EventListener.emit(GameEvent.PLACE_GRID_MOVE, this);\r\n        }\r\n    }\r\n\r\n    onTouchEnd(wpos: Vec2) {\r\n        if (this._isTouch) {\r\n            this._isTouch = false;\r\n            WeaponData.instance.isSelect = false;\r\n            this.onPlaceFinish();\r\n            this._touchStatus = TouchStatus.END;\r\n        }\r\n    }\r\n\r\n    onTouchCancle(wpos: Vec2) {\r\n        if (this._isTouch) {\r\n            this._isTouch = false;\r\n            WeaponData.instance.isSelect = false;\r\n            this._touchStatus = TouchStatus.CANCEL;\r\n            EventListener.emit(GameEvent.ADD_REMOVE_WEAPON_LIST, this.node)\r\n        }\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        EventListener.on(GameEvent.GAME_TOUCH_START, this.onTouchStart, this);\r\n        EventListener.on(GameEvent.GAME_TOUCH_MOVE, this.onTouchMove, this);\r\n        EventListener.on(GameEvent.GAME_TOUCH_END, this.onTouchEnd, this);\r\n        EventListener.on(GameEvent.GAME_TOUCH_CANCLE, this.onTouchEnd, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        EventListener.off(GameEvent.GAME_TOUCH_START, this.onTouchStart, this);\r\n        EventListener.off(GameEvent.GAME_TOUCH_MOVE, this.onTouchMove, this);\r\n        EventListener.off(GameEvent.GAME_TOUCH_END, this.onTouchEnd, this);\r\n        EventListener.off(GameEvent.GAME_TOUCH_CANCLE, this.onTouchEnd, this);\r\n    }\r\n}\r\n\r\n\r\nexport enum TouchStatus {\r\n    DEFAULT,\r\n    START,\r\n    MOVE,\r\n    END,\r\n    CANCEL\r\n}\r\n\r\n\r\n"]}