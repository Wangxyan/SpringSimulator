{"version":3,"sources":["file:///D:/CODE/cocos_workspace/%E8%83%8C%E5%8C%85%E8%8B%B1%E9%9B%84/assets/Scripts/Game/Mgr/BoxManager.ts"],"names":["_decorator","instantiate","Node","UITransform","v3","sp","BaseComponent","EventListener","GameEvent","ResourcesUtil","Constants","CoinObj","Util","ccclass","property","BoxManager","_pickBox","onEnable","on","CREATE_DROP_BOX","onCreateDropBox","onDisable","off","pos","path","battlePath","boxParent","setPosition","getPrefab","then","itemPrefab","boxItem","parent","boxSpine","getChildByName","getComponent","Skeleton","wpos","convertToWorldSpaceAR","scheduleOnce","showFlyGoldAnim","setCompleteListener","destroy","emit","RESERT_SELECT_BAG","coinObj","num","getRandomInt","WEAPON_CHANGE_COIN","clear"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAA2CC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAqBC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,E,OAAAA,E;AAAUC,MAAAA,E,OAAAA,E;;AACtGC,MAAAA,a;;AACEC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,a,iBAAAA,a;;AAEAC,MAAAA,S,iBAAAA,S;;AAEAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,I,iBAAAA,I;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBd,U;;4BAGjBe,U,WADZF,OAAO,CAAC,YAAD,C,UAEHC,QAAQ,CAACZ,IAAD,C,2BAFb,MACaa,UADb;AAAA;AAAA,0CAC8C;AAAA;AAAA;;AAAA;;AAAA,eAGlCC,QAHkC,GAGd,KAHc;AAAA;;AAMhCC,QAAAA,QAAQ,GAAS;AACvB;AAAA;AAAA,8CAAcC,EAAd,CAAiB;AAAA;AAAA,sCAAUC,eAA3B,EAA4C,KAAKC,eAAjD,EAAkE,IAAlE;AACH;;AAESC,QAAAA,SAAS,GAAS;AACxB;AAAA;AAAA,8CAAcC,GAAd,CAAkB;AAAA;AAAA,sCAAUH,eAA5B,EAA6C,KAAKC,eAAlD,EAAmE,IAAnE;AACH;AAED;;;AACAA,QAAAA,eAAe,CAACG,GAAD,EAAY;AACvB;AACA,cAAIC,IAAI,GAAG;AAAA;AAAA,sCAAUC,UAAV,GAAuB,SAAlC;AACA,eAAKC,SAAL,CAAeC,WAAf,CAA2B,CAA3B,EAA8B,CAA9B;AACA;AAAA;AAAA,8CAAcC,SAAd,CAAwBJ,IAAxB,EAA8BK,IAA9B,CAAoCC,UAAD,IAAwB;AACvD,gBAAIC,OAAO,GAAG9B,WAAW,CAAC6B,UAAD,CAAzB;AACAC,YAAAA,OAAO,CAACC,MAAR,GAAiB,KAAKN,SAAtB;AACAK,YAAAA,OAAO,CAACJ,WAAR,CAAoBJ,GAApB;AACA,gBAAIU,QAAQ,GAAGF,OAAO,CAACG,cAAR,CAAuB,KAAvB,EAA8BC,YAA9B,CAA2C9B,EAAE,CAAC+B,QAA9C,CAAf;AACA,gBAAIC,IAAI,GAAGN,OAAO,CAACI,YAAR,CAAqBhC,WAArB,EAAkCmC,qBAAlC,CAAwDlC,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAA1D,CAAX;AACA,iBAAKmC,YAAL,CAAkB,MAAM;AACpB,mBAAKC,eAAL,CAAqBH,IAArB;AACH,aAFD,EAEG,GAFH;AAGAJ,YAAAA,QAAQ,CAACQ,mBAAT,CAA6B,MAAM;AAC/BV,cAAAA,OAAO,CAACW,OAAR;AACA;AAAA;AAAA,kDAAcC,IAAd,CAAmB;AAAA;AAAA,0CAAUC,iBAA7B;AACH,aAHD;AAIH,WAbD;AAcH;AAED;;;AACAJ,QAAAA,eAAe,CAACH,IAAD,EAAa;AACxB,cAAIQ,OAAO,GAAG;AAAA;AAAA,mCAAd;AACAA,UAAAA,OAAO,CAACR,IAAR,GAAeA,IAAf;AACAQ,UAAAA,OAAO,CAACC,GAAR,GAAc;AAAA;AAAA,4BAAKC,YAAL,CAAkB,CAAlB,EAAqB,EAArB,CAAd;AACA;AAAA;AAAA,8CAAcJ,IAAd,CAAmB;AAAA;AAAA,sCAAUK,kBAA7B,EAAiDH,OAAjD;AACH;;AAEDI,QAAAA,KAAK,GAAG;AACJ,eAAKjC,QAAL,GAAgB,KAAhB;AACH;;AA7CyC,O;;;;;iBAExB,I","sourcesContent":["import { _decorator, AnimationComponent, Component, instantiate, Node, Prefab, tween, UITransform, v3, Vec3, sp } from 'cc';\r\nimport BaseComponent from '../../Frame/BaseComponent';\r\nimport { EventListener } from '../../Frame/EventListener';\r\nimport { GameEvent } from '../Event/GameEvent';\r\nimport { ResourcesUtil } from '../../Frame/ResourcesUtil';\r\nimport { GameDefine } from '../../GameDefine';\r\nimport { Constants } from '../../Constants';\r\nimport { HeroAnim } from '../Data/HeroData';\r\nimport { CoinObj } from '../Data/WeaponData';\r\nimport { Util } from '../../Frame/Util';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('BoxManager')\r\nexport class BoxManager extends BaseComponent {\r\n    @property(Node)\r\n    boxParent: Node = null;\r\n    private _pickBox: boolean = false;\r\n\r\n\r\n    protected onEnable(): void {\r\n        EventListener.on(GameEvent.CREATE_DROP_BOX, this.onCreateDropBox, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        EventListener.off(GameEvent.CREATE_DROP_BOX, this.onCreateDropBox, this);\r\n    }\r\n\r\n    /* 创建掉落宝箱 */\r\n    onCreateDropBox(pos: Vec3) {\r\n        //英雄移动动画\r\n        let path = Constants.battlePath + 'boxItem';\r\n        this.boxParent.setPosition(0, 0);\r\n        ResourcesUtil.getPrefab(path).then((itemPrefab: Prefab) => {\r\n            let boxItem = instantiate(itemPrefab);\r\n            boxItem.parent = this.boxParent;\r\n            boxItem.setPosition(pos);\r\n            let boxSpine = boxItem.getChildByName('box').getComponent(sp.Skeleton);\r\n            let wpos = boxItem.getComponent(UITransform).convertToWorldSpaceAR(v3(0, 0, 0));\r\n            this.scheduleOnce(() => {\r\n                this.showFlyGoldAnim(wpos);\r\n            }, 0.5)\r\n            boxSpine.setCompleteListener(() => {\r\n                boxItem.destroy();\r\n                EventListener.emit(GameEvent.RESERT_SELECT_BAG);\r\n            })\r\n        })\r\n    }\r\n\r\n    /* 转换飞的金币动画 */\r\n    showFlyGoldAnim(wpos: Vec3) {\r\n        let coinObj = new CoinObj();\r\n        coinObj.wpos = wpos;\r\n        coinObj.num = Util.getRandomInt(5, 10);\r\n        EventListener.emit(GameEvent.WEAPON_CHANGE_COIN, coinObj);\r\n    }\r\n\r\n    clear() {\r\n        this._pickBox = false;\r\n    }\r\n}\r\n\r\n\r\n"]}