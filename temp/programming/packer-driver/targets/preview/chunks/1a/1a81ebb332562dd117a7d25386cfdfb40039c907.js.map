{"version":3,"sources":["file:///D:/CODE/cocos_workspace/%E8%83%8C%E5%8C%85%E8%8B%B1%E9%9B%84/assets/Scripts/Game/Weapon/WeaponItem.ts"],"names":["_decorator","Color","instantiate","Label","ProgressBar","Sprite","Tween","tween","UITransform","v2","v3","Vec3","GameEvent","EventListener","ResourcesUtil","BaseComponent","WeaponData","SynItem","GridData","GridObj","Constants","AudioManager","OpenPopupManager","ccclass","property","WeaponItem","_touchStatus","_weaponKey","_weaponCfg","_point","_pointGridObj","_isShake","_placeStatus","_isTouch","point","weaponCfg","weaponKey","placeStatus","value","init","node","getChildByName","level","string","Level","progressBar","progress","initWeaponSize","setPointPosArr","setWeaponIcon","setNodeAngel","typeArr","Type","split","rowLen","Number","colLen","size","instance","getGridSizeByRowCol","scale","iconScale","getComponent","setContentSize","setPosition","width","height","icon","setScale","Points","i","length","item","j","element","gridObj","row","col","push","path","weaponIconPath","Res","geSpriteFrame","then","data","spriteFrame","bar","contentSize","setBuildWeaponPos","key","pos","setIconYellow","color","fromHEX","setIconDefault","onSetIconStatus","id","status","angle","onUpdateProgressBar","onSetStatusInit","stopAllByTarget","onSetIconShake","posX","time","by","position","union","repeatForever","start","onPenWeaponPopup","TouchStatus","START","itemPath","onWeaponRemove","emit","ADD_REMOVE_WEAPON_LIST","onWeapoPreRemove","ADD_PRE_WEAPON_LIST","onPlaceFinish","MOVE","WEAPON_PlACE","onWeaponUpgrade","isInner","group","weaponGroupNum","getWeaponCfgByLevel","updateGridItemData","Id","setSynEffect","synPath","getPrefab","synPrefab","playSound","synItem","parent","onTouchStart","wpos","touchPos","convertToNodeSpaceAR","x","y","checkPointinGrid","isSelect","gridEditMode","onTouchMove","WEAPON_MOVE","onTouchEnd","showWeaponDetailPopup","END","onTouchCancle","CANCEL","SET_BATTLE_BTN_STATUS","onEnable","on","GAME_TOUCH_START","GAME_TOUCH_MOVE","GAME_TOUCH_END","GAME_TOUCH_CANCLE","WEAPON_REMOVE","WEAPON_ICON_STATUS","WEAPON_ICON_STATUS_INIT","WEAPON_SHAKE","WEAPON_UPGRADE","onDisable","off"],"mappings":"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","sourcesContent":["import { _decorator, Color, Component, EventTouch, Input, input, instantiate, Label, Node, Prefab, ProgressBar, Sprite, SpriteFrame, Tween, tween, UITransform, v2, v3, Vec2, Vec3 } from 'cc';\r\nimport { WeaponCfg } from '../../Model/WeaponModel';\r\nimport { GameEvent } from '../Event/GameEvent';\r\nimport { EventListener } from '../../Frame/EventListener';\r\nimport { ResourcesUtil } from '../../Frame/ResourcesUtil';\r\nimport BaseComponent from '../../Frame/BaseComponent';\r\nimport { WeaponData } from '../Data/WeaponData';\r\nimport { SynItem } from '../Battle/SynItem';\r\nimport { GridData, GridObj } from '../Data/GridData';\r\nimport { Constants } from '../../Constants';\r\nimport { AudioManager } from '../../Frame/AudioManager';\r\nimport { OpenPopupManager } from '../../Frame/OpenPopupManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('WeaponItem')\r\nexport class WeaponItem extends BaseComponent {\r\n    @property(Label)\r\n    level: Label = null;\r\n    @property(Sprite)\r\n    icon: Sprite = null;\r\n    @property(Sprite)\r\n    bar: Sprite = null;\r\n    @property(ProgressBar)\r\n    progressBar: ProgressBar = null;\r\n    private _touchStatus: number = 0;//当前触摸状态\r\n    private _weaponKey: string = '';//唯一值\r\n    private _weaponCfg: WeaponCfg = null;\r\n    private _point: Node = null;\r\n    private _pointGridObj: Array<GridObj> = [];//占用点位置\r\n    private _isShake: boolean = false;//是否抖动\r\n    private _placeStatus: boolean = true; //true:放置  false:卸下\r\n    private _isTouch: boolean = false;//是否被点击\r\n\r\n    get point() {\r\n        return this._point;\r\n    }\r\n\r\n    get weaponCfg() {\r\n        return this._weaponCfg;\r\n    }\r\n\r\n    get weaponKey() {\r\n        return this._weaponKey;\r\n    }\r\n\r\n    set placeStatus(value: boolean) {\r\n        this._placeStatus = value;\r\n    }\r\n\r\n    init(weaponCfg: WeaponCfg, weaponKey: string, placeStatus: boolean) {\r\n        this._pointGridObj = [];\r\n        this._placeStatus = placeStatus;\r\n        this._weaponKey = weaponKey;\r\n        this._weaponCfg = weaponCfg;\r\n        this._isShake = false;\r\n        this._point = this.node.getChildByName('point');\r\n        this.level.string = `Lv${weaponCfg.Level}`;\r\n        this.progressBar.progress = 0;\r\n        this.initWeaponSize();\r\n        this.setPointPosArr();\r\n        this.setWeaponIcon();\r\n        this.setNodeAngel();\r\n    }\r\n\r\n    /* 初始武器格子尺寸 */\r\n    initWeaponSize() {\r\n        let typeArr = this._weaponCfg.Type.split('_');\r\n        let rowLen = Number(typeArr[1]);\r\n        let colLen = Number(typeArr[0]);\r\n        let size = GridData.instance.getGridSizeByRowCol(rowLen, colLen);\r\n        let scale = GridData.instance.iconScale;\r\n        this.node.getComponent(UITransform).setContentSize(size);\r\n        this.point.setPosition(-size.width / 2, size.height / 2);\r\n        this.icon.node.setScale(scale, scale, scale);\r\n    }\r\n\r\n    /* 设置点坐标 */\r\n    setPointPosArr() {\r\n        this._pointGridObj = [];\r\n        let point = this._weaponCfg.Points;\r\n        for (let i = 0; i < point.length; i++) {\r\n            const item = point[i];\r\n            for (let j = 0; j < item.length; j++) {\r\n                const element = item[j];\r\n                if (element) {\r\n                    let gridObj = new GridObj();\r\n                    gridObj.row = i;\r\n                    gridObj.col = j;\r\n                    this._pointGridObj.push(gridObj);\r\n                }\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /* 设置武器图标 */\r\n    setWeaponIcon() {\r\n        let path = Constants.weaponIconPath + this.weaponCfg.Res + '/spriteFrame';\r\n        ResourcesUtil.geSpriteFrame(path).then((data: SpriteFrame) => {\r\n            this.icon.spriteFrame = data;\r\n            this.bar.spriteFrame = data;\r\n            let size = this.icon.getComponent(UITransform).contentSize;\r\n            this.bar.node.setPosition(v3(0, -size.height / 2, 0));\r\n        })\r\n    }\r\n\r\n    /* 设置重组后武器的位置 */\r\n    setBuildWeaponPos(key: string, pos: Vec3) {\r\n        if (this._weaponKey == key) {\r\n            this.node.setPosition(pos);\r\n        }\r\n    }\r\n\r\n    setIconYellow() {\r\n        this.icon.getComponent(Sprite).color = new Color().fromHEX('dbc464');\r\n    }\r\n\r\n    setIconDefault() {\r\n        this.icon.getComponent(Sprite).color = new Color().fromHEX('ffffff');\r\n    }\r\n\r\n    onSetIconStatus(id: string, status: boolean) {\r\n        if (this.weaponKey == id) {\r\n            if (status) {\r\n                this.setIconYellow();\r\n            }\r\n            else {\r\n                this.setIconDefault();\r\n            }\r\n        }\r\n    }\r\n\r\n    setNodeAngel() {\r\n        let angle = this._placeStatus ? 0 : 10;\r\n        this.node.angle = angle;\r\n    }\r\n\r\n    /* 更新技能进度条 */\r\n    onUpdateProgressBar(value: number, id: string) {\r\n        if (this.weaponKey == id) {\r\n            this.progressBar.progress = value;\r\n        }\r\n    }\r\n\r\n    onSetStatusInit() {\r\n        this.setIconDefault();\r\n        this._isShake = false;\r\n        Tween.stopAllByTarget(this.icon.node);\r\n    }\r\n\r\n    onSetIconShake(id: string) {\r\n        if (this.weaponKey == id) {\r\n            //抖动\r\n            if (!this._isShake) {\r\n                this._isShake = true;\r\n                let posX = 5;\r\n                let time = 0.1;\r\n                this.icon.node.setPosition(0, 0, 0);\r\n                tween(this.icon.node).by(time, { position: v3(-posX, 0, 0) }).by(time, { position: v3(posX, 0, 0) }).by(time, { position: v3(posX, 0, 0) }).by(time, { position: v3(-posX, 0, 0) })\r\n                    .union().repeatForever().start();\r\n            }\r\n        }\r\n    }\r\n\r\n    /* 武器弹窗 */\r\n    onPenWeaponPopup() {\r\n        if (this._touchStatus == TouchStatus.START) {\r\n            let path = Constants.itemPath + this.weaponCfg.Res;\r\n            //TODO显示弹窗\r\n        }\r\n    }\r\n\r\n    /* 武器卸下 */\r\n    onWeaponRemove(id: string) {\r\n        if (this.weaponKey == id) {\r\n            //添加到待上阵武器列表\r\n            EventListener.emit(GameEvent.ADD_REMOVE_WEAPON_LIST, this.node);\r\n            this.placeStatus = false;\r\n            this.setNodeAngel();\r\n        }\r\n    }\r\n\r\n    /* 武器预卸下 */\r\n    onWeapoPreRemove() {\r\n        if (this._touchStatus == TouchStatus.START) {\r\n            // console.log('武器预卸下');\r\n            //武器预卸下\r\n            EventListener.emit(GameEvent.ADD_PRE_WEAPON_LIST, this.node);\r\n            this.placeStatus = true;\r\n            this.setNodeAngel();\r\n        }\r\n    }\r\n\r\n    /* 放置完成 */\r\n    onPlaceFinish() {\r\n        if (this._touchStatus == TouchStatus.MOVE) {\r\n            //放置完成\r\n            // console.log('放置完成');\r\n            EventListener.emit(GameEvent.WEAPON_PlACE, this);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 合成升级\r\n     * 1.合成后格子相同 直接合成\r\n     * 2.合成后格子不相同则直接卸下\r\n     * @param weaponKey 武器的唯一key\r\n     * @param isInner 内合成或者外合成\r\n     */\r\n    onWeaponUpgrade(weaponKey: string, isInner: boolean) {\r\n        if (this._weaponKey == weaponKey) {\r\n            let level = this._weaponCfg.Level + 1;\r\n            let group = this._weaponCfg.weaponGroupNum;\r\n            this._weaponCfg = WeaponData.instance.getWeaponCfgByLevel(level, group);\r\n            this.level.string = `Lv${this._weaponCfg.Level}`;\r\n            GridData.instance.updateGridItemData(weaponKey, this._weaponCfg.Id);\r\n            //播放合成特效\r\n            this.setSynEffect();\r\n            //设置资源\r\n            this.setWeaponIcon();\r\n        }\r\n    }\r\n\r\n    /* 设置合成特效 */\r\n    setSynEffect() {\r\n        let path = Constants.synPath;\r\n        ResourcesUtil.getPrefab(path).then((synPrefab: Prefab) => {\r\n            AudioManager.instance.playSound(4);\r\n            let synItem = instantiate(synPrefab);\r\n            synItem.parent = this.node;\r\n            synItem.getComponent(SynItem).init();\r\n        })\r\n    }\r\n\r\n    /* 关闭多触碰 */\r\n    /* 触摸点击 */\r\n    onTouchStart(wpos: Vec2) {\r\n        //是否触摸到武器(只能选中一个)\r\n        let touchPos = this.point.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(wpos.x, wpos.y, 0));\r\n        if (GridData.instance.checkPointinGrid(v2(touchPos.x, touchPos.y), this._pointGridObj) && !WeaponData.instance.isSelect && !GridData.instance.gridEditMode) {\r\n            this._isTouch = true;\r\n            WeaponData.instance.isSelect = true;\r\n            this._touchStatus = TouchStatus.START;\r\n        }\r\n    }\r\n\r\n    onTouchMove(wpos: Vec2) {\r\n        if (this._isTouch) {\r\n            this.onWeapoPreRemove();\r\n            this._touchStatus = TouchStatus.MOVE;\r\n            let pos = this.node.parent.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(wpos.x, wpos.y, 0));\r\n            this.node.setPosition(pos);\r\n            EventListener.emit(GameEvent.WEAPON_MOVE, this);\r\n        }\r\n    }\r\n\r\n    onTouchEnd(wpos: Vec2) {\r\n        if (this._isTouch) {\r\n            if (this._touchStatus == TouchStatus.START) {\r\n                //弹出详情\r\n                OpenPopupManager.instance.showWeaponDetailPopup(this.weaponCfg);\r\n            }\r\n            this._isTouch = false;\r\n            WeaponData.instance.isSelect = false;\r\n            this.onPenWeaponPopup();\r\n            this.onPlaceFinish();\r\n            this._touchStatus = TouchStatus.END;\r\n        }\r\n    }\r\n\r\n    onTouchCancle(wpos: Vec2) {\r\n        if (this._isTouch) {\r\n            this._isTouch = false;\r\n            WeaponData.instance.isSelect = false;\r\n            this._touchStatus = TouchStatus.CANCEL;\r\n            //添加到待上阵武器列表\r\n            EventListener.emit(GameEvent.ADD_REMOVE_WEAPON_LIST, this.node);\r\n            //设置战斗按钮状态\r\n            EventListener.emit(GameEvent.SET_BATTLE_BTN_STATUS);\r\n        }\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        EventListener.on(GameEvent.GAME_TOUCH_START, this.onTouchStart, this);\r\n        EventListener.on(GameEvent.GAME_TOUCH_MOVE, this.onTouchMove, this);\r\n        EventListener.on(GameEvent.GAME_TOUCH_END, this.onTouchEnd, this);\r\n        EventListener.on(GameEvent.GAME_TOUCH_CANCLE, this.onTouchEnd, this);\r\n\r\n        EventListener.on(GameEvent.WEAPON_REMOVE, this.onWeaponRemove, this);\r\n        EventListener.on(GameEvent.WEAPON_ICON_STATUS, this.onSetIconStatus, this);\r\n        EventListener.on(GameEvent.WEAPON_ICON_STATUS_INIT, this.onSetStatusInit, this);\r\n        EventListener.on(GameEvent.WEAPON_SHAKE, this.onSetIconShake, this);\r\n        EventListener.on(GameEvent.WEAPON_UPGRADE, this.onWeaponUpgrade, this);\r\n        // EventListener.on(GameEvent.WEAPON_PROGRESS_BAR, this.onUpdateProgressBar, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        EventListener.off(GameEvent.GAME_TOUCH_START, this.onTouchStart, this);\r\n        EventListener.off(GameEvent.GAME_TOUCH_MOVE, this.onTouchMove, this);\r\n        EventListener.off(GameEvent.GAME_TOUCH_END, this.onTouchEnd, this);\r\n        EventListener.off(GameEvent.GAME_TOUCH_CANCLE, this.onTouchEnd, this);\r\n\r\n        EventListener.off(GameEvent.WEAPON_REMOVE, this.onWeaponRemove, this);\r\n        EventListener.off(GameEvent.WEAPON_ICON_STATUS, this.onSetIconStatus, this);\r\n        EventListener.off(GameEvent.WEAPON_ICON_STATUS_INIT, this.onSetStatusInit, this);\r\n        EventListener.off(GameEvent.WEAPON_SHAKE, this.onSetIconShake, this);\r\n        EventListener.off(GameEvent.WEAPON_UPGRADE, this.onWeaponUpgrade, this);\r\n        // EventListener.off(GameEvent.WEAPON_PROGRESS_BAR, this.onUpdateProgressBar, this);\r\n    }\r\n}\r\n\r\n\r\nexport enum TouchStatus {\r\n    DEFAULT,\r\n    START,\r\n    MOVE,\r\n    END,\r\n    CANCEL\r\n}\r\n\r\n\r\n"]}