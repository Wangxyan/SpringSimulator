{"version":3,"sources":["file:///D:/CODE/cocos_workspace/%E8%83%8C%E5%8C%85%E8%8B%B1%E9%9B%84/assets/Scripts/Game/Battle/HeroHpItem.ts"],"names":["_decorator","Component","Label","Node","ProgressBar","tween","UITransform","EventListener","GameEvent","HeroAnim","HeroData","GameDefine","OpenPopupManager","Util","ccclass","property","HeroHpItem","init","scale","adapterScale","barAnim","getComponent","width","node","progress","hpText","string","instance","curHp","setScale","setHeroHp","maxHp","curWidth","bar","endWidth","offsetX","by","call","gameOver","gameStart","emit","HERO_ANIM","DIE","showGameOverPopup","destroy","start","onEnable","on","UPDATE_HERO_HP","onDisable","off"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, ProgressBar, tween, UITransform } from 'cc';\r\nimport { EventListener } from '../../Frame/EventListener';\r\nimport { GameEvent } from '../Event/GameEvent';\r\nimport { HeroAnim, HeroData } from '../Data/HeroData';\r\nimport { HeroBase } from '../Hero/HeroBase';\r\nimport { GameDefine } from '../../GameDefine';\r\nimport { OpenPopupManager } from '../../Frame/OpenPopupManager';\r\nimport { Util } from '../../Frame/Util';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroHpItem')\r\nexport class HeroHpItem extends Component {\r\n    @property(Node)\r\n    barAnim: Node = null;\r\n    @property(Node)\r\n    bar: Node = null;\r\n    @property(Label)\r\n    hpText: Label = null;\r\n    init() {\r\n        let scale = Util.adapterScale();\r\n        this.barAnim.getComponent(UITransform).width = this.node.getComponent(UITransform).width;\r\n        this.getComponent(ProgressBar).progress = 1;\r\n        this.hpText.string = `${HeroData.instance.curHp}`;\r\n        this.node.setScale(scale, scale);\r\n    }\r\n\r\n    setHeroHp() {\r\n        let curHp = HeroData.instance.curHp;\r\n        let maxHp = HeroData.instance.maxHp;\r\n        this.hpText.string = `${HeroData.instance.curHp}`;\r\n        if (curHp <= 0) { curHp = 0 };\r\n        this.getComponent(ProgressBar).progress = curHp / maxHp;\r\n        let curWidth = this.bar.getComponent(UITransform).width;\r\n        let endWidth = this.barAnim.getComponent(UITransform).width;\r\n        let offsetX = endWidth - curWidth;\r\n        tween(this.barAnim.getComponent(UITransform)).by(0.2, { width: -offsetX }).call((() => {\r\n            if (curHp <= 0) {\r\n                //游戏结束\r\n                GameDefine.gameOver = true;\r\n                GameDefine.gameStart = false;\r\n                //屏蔽游戏界面点击事件\r\n                // EventListener.emit(GameEvent.GAME_BLOCK_EVENT);\r\n                //播放死亡动画 弹出游戏结束弹窗\r\n                EventListener.emit(GameEvent.HERO_ANIM, HeroAnim.DIE);\r\n                OpenPopupManager.instance.showGameOverPopup(0);\r\n                this.node.destroy();\r\n            }\r\n        })).start();\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        EventListener.on(GameEvent.UPDATE_HERO_HP, this.setHeroHp, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        EventListener.off(GameEvent.UPDATE_HERO_HP, this.setHeroHp, this);\r\n    }\r\n}\r\n\r\n\r\n"]}