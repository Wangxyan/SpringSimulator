{"version":3,"sources":["file:///D:/CODE/cocos_workspace/%E8%83%8C%E5%8C%85%E8%8B%B1%E9%9B%84/assets/Scripts/Game/Data/GridData.ts"],"names":["GridData","WeaponObj","GridObj","Rect","Size","Vec3","Util","WeaponData","CfgMgr","BagCfg","_curGrid","_gridMapData","_bagCfg","_gridRowLen","_gridColLen","_gridWidth","_gredHeight","_space","_gridItemData","Map","_curWeaponTildeIndex","_gridEditMode","gridEditMode","value","iconScale","picture","space","bagCfg","curWeaponTildeIndex","gridWidth","gridHeight","init","initGridMapData","initGridItemData","getDataById","row_col","private_gridLen","split","private_grid","private_gridWidth","private_gredHeight","private_space","Number","addWeaponItem","forEach","weaponObj","key","data","i","length","gridObj","row","col","wid","weaponCfg","instance","getWeaponCfgById","id","getUuid","gid","points","Points","element","j","push","set","setRebuildGridMapData","weaponKey","getMaxGridMapSize","size","width","height","max_gridLen","rowLen","colLen","w","h","getGridMapSize","getGridSizeByRowCol","getGridMapData","getGridItemData","Array","from","values","getGridItemDataKeys","keys","getWeaponCharmByKey","get","charm","getWeaponKnowledgeByKey","knowledge","getWeaponTalentByKey","talent","getWeaponWealthByKey","wealth","getGridItemMapData","getItemPosByTiledObj","gridObjArr","startPos","getGridPosByTiled","endPos","pos","x","y","posX","posY","getGridIndexByTiled","getGridTiledByIndex","index","Math","floor","deletGridDataByWeaponId","has","delete","addGridDataByWeaponId","updateGridItemData","getTiledByPos","tiledX","tiledY","abs","getTiledIndexByPos","checkSameWeapoIdByKey","checkPointinGrid","touchPos","isTouch","rect","contains","getGridBgIndexByTiled","clear","_instance"],"mappings":"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","sourcesContent":["import { Rect, Size, Vec2, Vec3 } from \"cc\";\r\nimport { Util } from \"../../Frame/Util\";\r\nimport { WeaponData } from \"./WeaponData\";\r\nimport { CfgMgr } from \"../../Frame/CfgMgr\";\r\nimport { BagCfg } from \"../../Model/BagModel\";\r\n\r\nexport class GridData {\r\n    private _curGrid = 109;//当前位置表id\r\n    private _gridMapData: Array<Array<string>> = [['0', '0', '0'], ['0', '0', '0'], ['0', '0', '']];  //格子地图数据  0:有格子 '':没有格子   value=>武器唯一id\r\n    private _bagCfg: BagCfg = null;//背包配置数据\r\n    private _gridRowLen = 3; //格子行长度(每行多少个)\r\n    private _gridColLen = 3; //格子列长度(每列多少个)\r\n    private _gridWidth = 94;//格子宽度\r\n    private _gredHeight = 94;//格子高度\r\n    private _space = 10;//格子间隔\r\n    private _gridItemData: Map<string, WeaponObj> = new Map();//携带的武器数据  key=>武器唯一id\r\n    private _curWeaponTildeIndex: Array<number> = [];//当前武器位置索引\r\n    // 添加位置相关属性  \r\n    // private _mapPosition: Vec3 = new Vec3(0, 0, 0);\r\n\r\n    private _gridEditMode: boolean = false;//是否为格子编辑模式\r\n\r\n    get gridEditMode() {\r\n        return this._gridEditMode;\r\n    }\r\n\r\n    set gridEditMode(value: boolean) {\r\n        this._gridEditMode = value;\r\n    }\r\n\r\n    get iconScale() {\r\n        return this._bagCfg.picture;\r\n    }\r\n    get space() {\r\n        return this._space;\r\n    }\r\n\r\n    get bagCfg() {\r\n        return this._bagCfg;\r\n    }\r\n\r\n    get curWeaponTildeIndex() {\r\n        return this._curWeaponTildeIndex;\r\n    }\r\n\r\n    set curWeaponTildeIndex(value: Array<number>) {\r\n        this._curWeaponTildeIndex = value;\r\n    }\r\n\r\n    get gridWidth() {\r\n        return this._gridWidth;\r\n    }\r\n\r\n    get gridHeight() {\r\n        return this._gredHeight;\r\n    }\r\n\r\n    init() {\r\n        this.initGridMapData();\r\n        this.initGridItemData();\r\n    }\r\n\r\n    //get mapPosition() {\r\n    //    return this._mapPosition;\r\n    //}\r\n\r\n    //set mapPosition(value: Vec3) {\r\n    //    this._mapPosition = value;\r\n    //}  \r\n\r\n    /* 初始化格子数据 */\r\n    initGridMapData() {\r\n\r\n        this._bagCfg = CfgMgr.getDataById<BagCfg>(new BagCfg(), this._curGrid);\r\n        let row_col = this._bagCfg.private_gridLen.split('_');\r\n        this._gridMapData = this._bagCfg.private_grid;\r\n        this._gridWidth = this._bagCfg.private_gridWidth;\r\n        this._gredHeight = this._bagCfg.private_gredHeight;\r\n        this._space = this._bagCfg.private_space;\r\n        this._gridColLen = Number(row_col[0]);\r\n        this._gridRowLen = Number(row_col[1]);\r\n\r\n        // 从配置中读取位置信息（如果有的话）  \r\n        //if (this._bagCfg.mapPosition) {\r\n        //    this._mapPosition = new Vec3(this._bagCfg.mapPosition.x, this._bagCfg.mapPosition.y, 0);  \r\n    }\r\n\r\n    /* 初始携带的武器数据 */\r\n    initGridItemData() {\r\n        //调试 初始携带武器数据\r\n        this.addWeaponItem(1001);\r\n\r\n        //初始化地图格子数据\r\n        this._gridItemData.forEach((weaponObj, key) => {\r\n            let data = weaponObj.data;\r\n            for (let i = 0; i < data.length; i++) {\r\n                const gridObj = data[i];\r\n                this._gridMapData[gridObj.row][gridObj.col] = key;\r\n            }\r\n        })\r\n        // console.log('携带武器数据', this._gridItemData);\r\n        // console.log('初始格子数据', this._gridMapData);\r\n    }\r\n\r\n    /**\r\n     * 添加携带的武器id\r\n     * @param wid \r\n     */\r\n    addWeaponItem(wid: number) {\r\n        let weaponCfg = WeaponData.instance.getWeaponCfgById(wid);\r\n        let weaponObj = new WeaponObj();\r\n        weaponObj.id = Util.getUuid(10);\r\n        weaponObj.gid = this._curGrid;\r\n        weaponObj.wid = wid;\r\n        let points = weaponCfg.Points;\r\n        let data: Array<GridObj> = [];\r\n        for (let i = 0; i < points.length; i++) {\r\n            const element = points[i];\r\n            for (let j = 0; j < element.length; j++) {\r\n                let gridObj = new GridObj();\r\n                gridObj.row = i;\r\n                gridObj.col = j;\r\n                data.push(gridObj);\r\n            }\r\n\r\n        }\r\n        weaponObj.data = data;\r\n        this._gridItemData.set(weaponObj.id, weaponObj);\r\n    }\r\n\r\n    /* 设置重组格子数据 */\r\n    setRebuildGridMapData(value: Array<Array<string>>) {\r\n        let row = value.length;\r\n        let col = value[0].length;\r\n        this._gridMapData = value;\r\n        this._bagCfg.private_gridLen = row + '_' + col;\r\n        this._gridColLen = row;\r\n        this._gridRowLen = col;\r\n        //设置武器位置数据\r\n        this._gridItemData.forEach((weaponObj, key) => {\r\n            let data: Array<GridObj> = [];\r\n            for (let i = 0; i < value.length; i++) {\r\n                const element = value[i];\r\n                for (let j = 0; j < element.length; j++) {\r\n                    const weaponKey = element[j];\r\n                    if (weaponKey == key) {\r\n                        let gridObj = new GridObj();\r\n                        gridObj.row = i;\r\n                        gridObj.col = j;\r\n                        data.push(gridObj);\r\n                    }\r\n                }\r\n\r\n            }\r\n            weaponObj.data = data;\r\n        })\r\n    }\r\n\r\n    /* 获取最大背包尺寸 */\r\n    getMaxGridMapSize() {\r\n        let size = new Size();\r\n        let bagCfg = this.bagCfg;\r\n        let width = bagCfg.private_gridWidth;\r\n        let height = bagCfg.private_gredHeight;\r\n        let space = bagCfg.private_space;\r\n        let row_col = bagCfg.max_gridLen.split('_');\r\n        let rowLen = Number(row_col[0]);\r\n        let colLen = Number(row_col[1]);\r\n        let w = colLen * width + (colLen - 1) * space;\r\n        let h = rowLen * height + (rowLen - 1) * space;\r\n        size.width = w;\r\n        size.height = h;\r\n        return size;\r\n    }\r\n\r\n    /* 获取背包尺寸 */\r\n    getGridMapSize() {\r\n        let size = new Size();\r\n        let bagCfg = this.bagCfg;\r\n        let width = bagCfg.private_gridWidth;\r\n        let height = bagCfg.private_gredHeight;\r\n        let space = bagCfg.private_space;\r\n        let row_col = bagCfg.private_gridLen.split('_');\r\n        let rowLen = Number(row_col[1]);\r\n        let colLen = Number(row_col[0]);\r\n        let w = rowLen * width + (rowLen - 1) * space;\r\n        let h = colLen * height + (colLen - 1) * space;\r\n        size.width = w;\r\n        size.height = h;\r\n        return size;\r\n    }\r\n\r\n    /**\r\n     * 通过行列数量获取尺寸\r\n     * @param rowLen \r\n     * @param colLen \r\n     */\r\n    getGridSizeByRowCol(rowLen: number, colLen: number) {\r\n        let size = new Size();\r\n        let bagCfg = this.bagCfg;\r\n        let width = bagCfg.private_gridWidth;\r\n        let height = bagCfg.private_gredHeight;\r\n        let space = bagCfg.private_space;\r\n        let w = rowLen * width + (rowLen - 1) * space;\r\n        let h = colLen * height + (colLen - 1) * space;\r\n        size.width = w;\r\n        size.height = h;\r\n        return size;\r\n    }\r\n\r\n    /* 获取格子数据 */\r\n    getGridMapData() {\r\n        return this._gridMapData;\r\n    }\r\n\r\n    /* 获取携带的武器位置数据 */\r\n    getGridItemData() {\r\n        return Array.from(this._gridItemData.values());\r\n    }\r\n\r\n    /* 获取携带的武器唯一键值 */\r\n    getGridItemDataKeys() {\r\n        return Array.from(this._gridItemData.keys());\r\n    }\r\n\r\n    /*获取武器的魅力加成*/\r\n    getWeaponCharmByKey(key: string) {\r\n        let weaponObj = this._gridItemData.get(key);\r\n        let weaponCfg = WeaponData.instance.getWeaponCfgById(weaponObj.wid);\r\n        let values = weaponCfg.charm;\r\n        return values;\r\n    }\r\n\r\n    /*获取武器的知识加成*/\r\n    getWeaponKnowledgeByKey(key: string) {\r\n        let weaponObj = this._gridItemData.get(key);\r\n        let weaponCfg = WeaponData.instance.getWeaponCfgById(weaponObj.wid);\r\n        let values = weaponCfg.knowledge;\r\n        return values;\r\n    }\r\n    \r\n    /*获取武器的才艺加成*/\r\n    getWeaponTalentByKey(key: string) {\r\n        let weaponObj = this._gridItemData.get(key);\r\n        let weaponCfg = WeaponData.instance.getWeaponCfgById(weaponObj.wid);\r\n        let values = weaponCfg.talent;\r\n        return values;\r\n    }\r\n    \r\n    /*获取武器的财富加成*/\r\n    getWeaponWealthByKey(key: string) {\r\n        let weaponObj = this._gridItemData.get(key);\r\n        let weaponCfg = WeaponData.instance.getWeaponCfgById(weaponObj.wid);\r\n        let values = weaponCfg.wealth;\r\n        return values;\r\n    }\r\n\r\n    /*获取携带的武器Map数据  */\r\n    getGridItemMapData() {\r\n        return this._gridItemData;\r\n    }\r\n\r\n    /**\r\n     * 通过位置组获取位置中点坐标\r\n     * @param gridObjArr \r\n     */\r\n    getItemPosByTiledObj(gridObjArr: Array<GridObj>) {\r\n        let startPos = this.getGridPosByTiled(gridObjArr[0]);\r\n        let endPos = this.getGridPosByTiled(gridObjArr[gridObjArr.length - 1]);\r\n        let pos = new Vec3(0, 0, 0);\r\n        pos.x = (startPos.x + endPos.x) / 2;\r\n        pos.y = (startPos.y + endPos.y) / 2;\r\n        return pos;\r\n    }\r\n\r\n    /**\r\n     * 通过位置获取坐标\r\n     * @param gridObj \r\n     * @returns \r\n     */\r\n    getGridPosByTiled(gridObj: GridObj) {\r\n        let posX = gridObj.col * this._gridWidth + this._gridWidth / 2 + gridObj.col * this._space;\r\n        let posY = gridObj.row * this._gredHeight + this._gredHeight / 2 + gridObj.row * this._space;\r\n        return new Vec3(posX, -posY);\r\n    }\r\n\r\n    /**\r\n     * 通过位置获取位置索引\r\n     * @param row \r\n     * @param col \r\n     */\r\n    getGridIndexByTiled(row: number, col: number) {\r\n        return row * this._gridRowLen + col;\r\n    }\r\n\r\n    /**\r\n     * 通过位置索引获取位置\r\n     * @param index \r\n     */\r\n    getGridTiledByIndex(index: number) {\r\n        let row = Math.floor(index / this._gridRowLen);\r\n        let col = index % this._gridRowLen;\r\n        let gridObj = new GridObj();\r\n        gridObj.row = row;\r\n        gridObj.col = col;\r\n        return gridObj;\r\n    }\r\n\r\n    /**\r\n     * 通过武器唯一id 删除位置数据\r\n     * @param id   武器唯一id\r\n     */\r\n    deletGridDataByWeaponId(id: string) {\r\n        if (this._gridItemData.has(id)) {\r\n            let weaponObj = this._gridItemData.get(id)\r\n            let gridObjArr = weaponObj.data;\r\n            for (let i = 0; i < gridObjArr.length; i++) {\r\n                const gridObj = gridObjArr[i];\r\n                this._gridMapData[gridObj.row][gridObj.col] = '0';\r\n            }\r\n            this._gridItemData.delete(id);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加放置数据\r\n     * @param gridObjArr \r\n     * @param wid \r\n     */\r\n    addGridDataByWeaponId(gridObjArr: Array<GridObj>, wid: number, weaponKey: string) {\r\n        let weaponObj = new WeaponObj();\r\n        weaponObj.id = weaponKey;\r\n        weaponObj.gid = this._curGrid;\r\n        weaponObj.wid = wid;\r\n        weaponObj.data = gridObjArr;\r\n\r\n        this._gridItemData.set(weaponObj.id, weaponObj);\r\n        for (let i = 0; i < gridObjArr.length; i++) {\r\n            const element = gridObjArr[i];\r\n            this._gridMapData[element.row][element.col] = weaponObj.id;\r\n        }\r\n    }\r\n\r\n    /* 合成更新 */\r\n    updateGridItemData(weaponKey: string, wid: number) {\r\n        if (this._gridItemData.has(weaponKey)) {\r\n            let weaponObj = this._gridItemData.get(weaponKey)\r\n            weaponObj.wid = wid;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 通过坐标获取位置\r\n     * @param pos \r\n     */\r\n    getTiledByPos(pos: Vec3) {\r\n        let tiledX = pos.x > 0 ? Math.floor((pos.x - this._gridWidth / 2) / (this._gridWidth + this._space)) : 3;\r\n        let tiledY = pos.y < 0 ? Math.floor((Math.abs(pos.y) - this._gredHeight / 2) / (this._gredHeight + this._space)) : 3;\r\n        let gridObj = new GridObj();\r\n        gridObj.row = tiledY;\r\n        gridObj.col = tiledX;\r\n        return gridObj;\r\n    }\r\n\r\n    /**\r\n     * 通过位置获取位置索引\r\n     * @param pos \r\n     */\r\n    getTiledIndexByPos(pos: Vec3) {\r\n        let gridObj = this.getTiledByPos(pos);\r\n        if (gridObj.col < 0 || gridObj.row < 0 || gridObj.col > (this._gridRowLen - 1) || gridObj.row > (this._gridColLen - 1)) {\r\n            return -1\r\n        }\r\n        return this.getGridIndexByTiled(gridObj.row, gridObj.col);\r\n    }\r\n\r\n    /* 检测武器id是否相同 */\r\n    checkSameWeapoIdByKey(weaponKey: string, wid: number) {\r\n        if (this._gridItemData.has(weaponKey)) {\r\n            let weaponObj = this._gridItemData.get(weaponKey);\r\n            if (wid == weaponObj.wid) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /* 间隔触摸点是否在位置上 */\r\n    checkPointinGrid(touchPos: Vec2, gridObjArr: Array<GridObj>) {\r\n        let isTouch = false;\r\n        for (let i = 0; i < gridObjArr.length; i++) {\r\n            const gridObj = gridObjArr[i];\r\n            let pos = this.getGridPosByTiled(gridObj);\r\n            let rect = new Rect(pos.x - this._gridWidth / 2, pos.y - this.gridHeight / 2, this.gridWidth, this.gridHeight);\r\n            if (rect.contains(touchPos)) {\r\n                isTouch = true;\r\n                break;\r\n            }\r\n        }\r\n        return isTouch;\r\n    }\r\n\r\n\r\n    /**\r\n    * 通过位置获取位置索引\r\n    * @param row \r\n    * @param col \r\n    */\r\n    getGridBgIndexByTiled(row: number, col: number) {\r\n        let row_col = this._bagCfg.max_gridLen.split('_');\r\n        return row * Number(row_col[1]) + col;\r\n    }\r\n\r\n\r\n    clear() {\r\n        this._gridItemData.clear();\r\n        this._curWeaponTildeIndex = [];\r\n        this._bagCfg = null;\r\n        this._gridEditMode = false;\r\n    }\r\n\r\n    private static _instance: GridData = null;\r\n    public static get instance(): GridData {\r\n        if (!this._instance) {\r\n            this._instance = new GridData();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    \r\n\r\n}\r\n\r\n\r\n\r\nexport class WeaponObj {\r\n    id: string;//唯一id\r\n    wid: number;//武器id\r\n    gid: number;//格子表id\r\n    data: Array<GridObj>;//位置数据\r\n}\r\n\r\nexport class GridObj {\r\n    row: number;//行\r\n    col: number;//列\r\n}\r\n"]}