{"version":3,"sources":["file:///D:/CODE/cocos_workspace/%E8%83%8C%E5%8C%85%E8%8B%B1%E9%9B%84/assets/Scripts/Game/Mgr/SkillManager.ts"],"names":["_decorator","Component","instantiate","Node","Sprite","GameEvent","EventListener","SkillData","ResourcesUtil","PoolManager","Constants","SkillUpgradeData","ccclass","property","SkillManager","_skillPrefabItemMap","Map","init","instance","onEnable","on","CREATE_SKILL_EFFECT","onCreateSkillEffect","onDisable","off","skillBulletObj","targetPos","angle","deltaTime","scheduleOnce","skillItem","skillId","skillCfg","Id","skillCom","has","getNodeItemById","get","toString","skillParentUp","addChild","setPosition","pos","components","path","battSkillPath","getPrefab","then","skillPrefab","itemPath","weaponIconPath","Bullet","getSpriteFrame","data","iconSprite","getChildByName","getComponent","spriteFrame","node","Angle","setScale","Scale","set","clear"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Node, Prefab, Sprite, SpriteFrame, Vec3 } from 'cc';\r\nimport { GameEvent } from '../Event/GameEvent';\r\nimport { EventListener } from '../../Frame/EventListener';\r\nimport { SkillBulletObj, SkillData } from '../Data/SkillData';\r\nimport { ResourcesUtil } from '../../Frame/ResourcesUtil';\r\nimport { PoolManager } from '../../Frame/PoolManager';\r\nimport { Constants } from '../../Constants';\r\nimport { SkillUpgradeData } from '../Data/SkillUpgradeData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('SkillManager')\r\nexport class SkillManager extends Component {\r\n    @property(Node)\r\n    skillParentUp: Node = null;\r\n\r\n    private _skillPrefabItemMap: Map<number | string, Node> = new Map(); //技能预制体\r\n\r\n    init() {\r\n        SkillUpgradeData.instance.init();\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        EventListener.on(GameEvent.CREATE_SKILL_EFFECT, this.onCreateSkillEffect, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        EventListener.off(GameEvent.CREATE_SKILL_EFFECT, this.onCreateSkillEffect, this);\r\n    }\r\n\r\n    onCreateSkillEffect(skillBulletObj: SkillBulletObj, targetPos: Vec3, angle: number, deltaTime = 0) {\r\n        this.scheduleOnce(() => {\r\n            let skillItem: Node = null;\r\n            let skillId = skillBulletObj.skillCfg.Id;\r\n            let skillCom = null;\r\n            if (this._skillPrefabItemMap.has(skillId)) {\r\n                skillItem = PoolManager.instance.getNodeItemById(this._skillPrefabItemMap.get(skillId), skillId.toString());\r\n                this.skillParentUp.addChild(skillItem);\r\n                skillItem.setPosition(skillBulletObj.pos);\r\n                skillCom = skillItem.components[1];\r\n                skillCom.init(skillBulletObj, targetPos, angle);\r\n            }\r\n            else {\r\n                //动态加载\r\n                let path = Constants.battSkillPath;\r\n                ResourcesUtil.getPrefab(path).then((skillPrefab: Prefab) => {\r\n                    //加载资源\r\n                    let itemPath = Constants.weaponIconPath + skillBulletObj.skillCfg.Bullet + '/spriteFrame';\r\n                    ResourcesUtil.getSpriteFrame(itemPath).then((data: SpriteFrame) => {\r\n                        skillItem = instantiate(skillPrefab);\r\n                        let iconSprite = skillItem.getChildByName('icon').getComponent(Sprite);\r\n                        iconSprite.spriteFrame = data;\r\n                        iconSprite.node.angle = skillBulletObj.skillCfg.Angle;\r\n                        iconSprite.node.setScale(skillBulletObj.skillCfg.Scale, skillBulletObj.skillCfg.Scale);\r\n                        this.skillParentUp.addChild(skillItem);\r\n                        skillItem.setPosition(skillBulletObj.pos);\r\n                        skillCom = skillItem.components[1];\r\n                        skillCom.init(skillBulletObj, targetPos, angle);\r\n                        this._skillPrefabItemMap.set(skillId, skillItem);\r\n                    })\r\n                })\r\n            }\r\n        }, deltaTime)\r\n    }\r\n\r\n    clear() {\r\n        SkillData.instance.clear();\r\n        SkillUpgradeData.instance.clear();\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}