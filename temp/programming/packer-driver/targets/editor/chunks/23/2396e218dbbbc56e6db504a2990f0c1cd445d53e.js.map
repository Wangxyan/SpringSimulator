{"version":3,"sources":["file:///D:/CODE/cocos_workspace/%E8%83%8C%E5%8C%85%E8%8B%B1%E9%9B%84/assets/Scripts/Frame/GameController.ts"],"names":["game","Game","timeScale","gameTimeScale","_calculateDT","now","performance","_deltaTime","_startTime","DEBUG_DT_THRESHOLD","frameTime","getGameTimeScale","setGameTimeScale","time","changeTimeScale","pause_data","state_b","physics_2d_b","physics_3d_b","scheduler_as","anim_as","tween_target_as","spine_as","spine_TimeScale","Map","pause_config","exclude_as","recu_exclude_as","recu_node_list","node_","result_as","push","children","forEach","v1","quick","cc","director","getScheduler","setTimeScale","pause","config_","pauseAllTargets","anim_system","getSystem","AnimationManager","ID","splice","length","array","getScene","getComponentsInChildren","sp","Skeleton","skeletonData","set","name","TweenSystem","instance","ActionManager","pauseAllRunningActions","resume_node","resume","resumeTargets","isPlaying","isPaused","play","has","get","pause_node","args1_","node_as","Array","isArray","pauseTarget","getComponent","Animation","dragonBones","ArmatureDisplay","resumeTarget","GameController"],"mappings":"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","sourcesContent":["import * as cc from \"cc\";\nimport { game, Game } from \"cc\";\nimport * as env from \"cc/env\";\n\n/**游戏 */\nmodule GameController {\n\n\tvar timeScale = 1;\n\tvar gameTimeScale = 1;\n\n\t//@ts-ignore\n\tgame._calculateDT = function (now: number) {\n\t\tif (!now) now = performance.now();\n\t\tthis._deltaTime = now > this._startTime ? (now - this._startTime) / 1000 : 0;\n\t\tif (this._deltaTime > Game.DEBUG_DT_THRESHOLD) {\n\t\t\tthis._deltaTime = this.frameTime / 1000;\n\t\t}\n\t\tthis._startTime = now;\n\t\tthis._deltaTime = this._deltaTime * timeScale;\n\t\treturn this._deltaTime;// this._deltaTime * timeScale;\n\t};\n\n\texport function getGameTimeScale(): number {\n\t\treturn gameTimeScale;\n\t}\n\n\texport function setGameTimeScale(time: number): void {\n\t\tgameTimeScale = time;\n\t}\n\n\texport function changeTimeScale(time: number): void {\n\t\ttimeScale = time;\n\t}\n\t/*---------enum_private */\n\t/*---------enum_public */\n\t/*---------var_private */\n\texport const pause_data = new (class {\n\t\t/**暂停状态 */\n\t\tstate_b = false;\n\t\t/**2d物理系统状态 */\n\t\tphysics_2d_b: boolean;\n\t\t/**3d物理系统状态 */\n\t\tphysics_3d_b: boolean;\n\t\t/**定时器对象列表 */\n\t\tscheduler_as: any[];\n\t\t/**动画列表 */\n\t\tanim_as: cc.AnimationState[] = [];\n\t\t/**缓动对象列表 */\n\t\ttween_target_as: any[];\n\t\t/**龙骨组件列表 */\n\t\t// dragon_bones_as: cc.dragonBones.ArmatureDisplay[];\n\t\tspine_as: cc.sp.Skeleton[];\n\t\tspine_TimeScale: Map<string, number> = new Map();//恢复龙骨缩放值\n\n\t})();\n\t// const pause_scene_config: project_config.scene_config_base = Object.create(null);\n\t/*---------var_public */\n\t/*---------class_private */\n\t/*---------class_public */\n\t/**暂停游戏配置 */\n\texport class pause_config {\n\t\t/**排除节点 */\n\t\texclude_as?: cc.Node[];\n\t\t/**递归排除节点 */\n\t\trecu_exclude_as?: cc.Node[];\n\t}\n\t/*---------function_private */\n\tfunction recu_node_list(node_: cc.Node, result_as: cc.Node[] = []): cc.Node[] {\n\t\tif (!node_) {\n\t\t\treturn result_as;\n\t\t}\n\t\tresult_as.push(node_);\n\t\tnode_.children.forEach(v1 => {\n\t\t\tresult_as.push(v1);\n\t\t\trecu_node_list(v1);\n\t\t});\n\t\treturn result_as;\n\t}\n\n\texport function quick(timeScale: number): void {\n\t\tcc.director.getScheduler().setTimeScale(timeScale);\n\t}\n\n\t/*---------function_public */\n\t/**暂停游戏 */\n\texport function pause(config_?: pause_config): void {\n\t\tif (pause_data.state_b) {\n\t\t\treturn;\n\t\t}\n\t\t// 暂停定时器\n\t\tpause_data.scheduler_as = cc.director.getScheduler().pauseAllTargets();\n\t\t// 暂停当前动画\n\t\t{\n\t\t\tlet anim_system = cc.director.getSystem(cc.AnimationManager.ID);\n\t\t\tpause_data.anim_as.splice(0, pause_data.anim_as.length, ...anim_system[\"_anims\"].array);\n\t\t\tpause_data.anim_as.forEach(v1 => {\n\t\t\t\tv1.pause();\n\t\t\t});\n\t\t}\n\t\t// 暂停龙骨动画\n\t\t{\n\t\t\tpause_data.spine_as = cc.director\n\t\t\t\t.getScene()\n\t\t\t\t.getComponentsInChildren(cc.sp.Skeleton);\n\t\t\tpause_data.spine_as.forEach(v1 => {\n\t\t\t\tif (v1.skeletonData) {\n\t\t\t\t\tpause_data.spine_TimeScale.set(v1.skeletonData.name, v1.timeScale);\n\t\t\t\t\tv1.timeScale = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t{\n\t\t\t// pause_data.dragon_bones_as = cc.director\n\t\t\t// \t.getScene()\n\t\t\t// \t.getComponentsInChildren(cc.dragonBones.ArmatureDisplay);\n\t\t\t// pause_data.dragon_bones_as.forEach(v1 => {\n\t\t\t// \tv1.timeScale = 0;\n\t\t\t// });\n\t\t}\n\t\t// 暂停当前缓动\n\t\tpause_data.tween_target_as = cc.TweenSystem.instance.ActionManager.pauseAllRunningActions();\n\t\t// 暂停物理系统\n\t\t{\n\t\t\t// if (cc.PhysicsSystem2D && cc.PhysicsSystem2D.instance.enable) {\n\t\t\t// \tpause_data.physics_2d_b = cc.PhysicsSystem2D.instance.enable;\n\t\t\t// \tcc.PhysicsSystem2D.instance.enable = false;\n\t\t\t// }\n\t\t\t// if (cc.PhysicsSystem && cc.PhysicsSystem.instance.enable) {\n\t\t\t// \tpause_data.physics_3d_b = cc.PhysicsSystem.instance.enable;\n\t\t\t// \tcc.PhysicsSystem.instance.enable = false;\n\t\t\t// }\n\t\t}\n\t\t// 恢复排除节点\n\t\tif (config_) {\n\t\t\tlet exclude_as: cc.Node[] = [];\n\t\t\texclude_as.push(...config_.exclude_as);\n\t\t\tconfig_.recu_exclude_as?.forEach(v1 => {\n\t\t\t\texclude_as.push(...recu_node_list(v1));\n\t\t\t});\n\t\t\texclude_as.forEach(v1 => {\n\t\t\t\tresume_node(v1);\n\t\t\t});\n\t\t}\n\t\tpause_data.state_b = true;\n\t}\n\t/**恢复游戏 */\n\texport function resume(): void {\n\t\t// 恢复定时器\n\t\tcc.director.getScheduler().resumeTargets(pause_data.scheduler_as);\n\t\t// 恢复动画\n\t\tpause_data.anim_as.forEach(v1 => {\n\t\t\tif (v1.isPlaying && v1.isPaused) {\n\t\t\t\tv1.play();\n\t\t\t}\n\t\t});\n\t\t// 恢复龙骨动画\n\t\t// pause_data.dragon_bones_as.forEach(v1 => {\n\t\t// \tv1.timeScale = 1;\n\t\t// });\n\n\t\tif (pause_data.spine_as) {\n\t\t\tpause_data.spine_as.forEach(v1 => {\n\t\t\t\tif (v1.skeletonData) {\n\t\t\t\t\tv1.timeScale = pause_data.spine_TimeScale.has(v1.skeletonData.name) ? pause_data.spine_TimeScale.get(v1.skeletonData.name) : 1;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// 恢复缓动\n\t\tcc.TweenSystem.instance.ActionManager.resumeTargets(pause_data.tween_target_as);\n\t\t// 恢复物理系统\n\t\t{\n\t\t\t// if (pause_data.physics_2d_b) {\n\t\t\t// \tcc.PhysicsSystem2D.instance.enable = pause_data.physics_2d_b;\n\t\t\t// }\n\t\t\t// if (pause_data.physics_3d_b) {\n\t\t\t// \tcc.PhysicsSystem.instance.enable = pause_data.physics_3d_b;\n\t\t\t// }\n\t\t}\n\t\tpause_data.state_b = false;\n\t}\n\t/**暂停节点\n\t * - 物理系统需手动启用/禁用\n\t */\n\texport function pause_node(node_: cc.Node): void;\n\texport function pause_node(node_as_: cc.Node[]): void;\n\texport function pause_node(args1_: cc.Node | cc.Node[]): void {\n\t\tlet node_as: cc.Node[];\n\t\tif (Array.isArray(args1_)) {\n\t\t\tnode_as = args1_;\n\t\t} else {\n\t\t\tnode_as = [args1_];\n\t\t}\n\t\tnode_as.forEach(v1 => {\n\t\t\t// 暂停定时器\n\t\t\tcc.director.getScheduler().pauseTarget(v1);\n\t\t\t// 暂停动画\n\t\t\tv1.getComponent(cc.Animation)?.pause();\n\t\t\t// 暂停龙骨\n\t\t\tif (v1.getComponent(cc.dragonBones.ArmatureDisplay)) {\n\t\t\t\tv1.getComponent(cc.dragonBones.ArmatureDisplay).timeScale = 0;\n\t\t\t}\n\t\t\t// 暂停缓动\n\t\t\tcc.TweenSystem.instance.ActionManager.pauseTarget(v1);\n\t\t});\n\t}\n\t/**恢复节点 */\n\texport function resume_node(node_: cc.Node): void;\n\texport function resume_node(node_as_: cc.Node[]): void;\n\texport function resume_node(args1_: cc.Node | cc.Node[]): void {\n\t\tlet node_as: cc.Node[];\n\t\tif (Array.isArray(args1_)) {\n\t\t\tnode_as = args1_;\n\t\t} else {\n\t\t\tnode_as = [args1_];\n\t\t}\n\t\tnode_as.forEach(v1 => {\n\t\t\t// 恢复定时器\n\t\t\tcc.director.getScheduler().resumeTarget(v1);\n\t\t\t// 恢复动画\n\t\t\tv1.getComponent(cc.Animation)?.resume();\n\t\t\t// 恢复龙骨\n\t\t\tif (v1.getComponent(cc.dragonBones.ArmatureDisplay)) {\n\t\t\t\tv1.getComponent(cc.dragonBones.ArmatureDisplay).timeScale = 1;\n\t\t\t}\n\t\t\t// 恢复缓动\n\t\t\tcc.TweenSystem.instance.ActionManager.resumeTarget(v1);\n\t\t});\n\t}\n\t/*---------logic */\n}\n\nexport default GameController;"]}