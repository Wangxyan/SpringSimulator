{"version":3,"sources":["file:///D:/CODE/cocos_workspace/%E8%83%8C%E5%8C%85%E8%8B%B1%E9%9B%84/assets/Scripts/Frame/PopupManager.ts"],"names":["PopupOptions","_decorator","find","isValid","Vec3","ResourcesUtil","ccclass","property","SHOW_STR_INTERVAL_TIME","PopupManager","_dictSharedPanel","_dictLoading","_arrPopupDialog","_hidePopupArr","_showTipsTime","instance","_instance","isDialogVisible","panelPath","hasOwnProperty","panel","active","parent","show","options","args","cb","path","closeCur","hideJoinPopup","idxSplit","lastIndexOf","scriptName","slice","script","getComponent","script2","charAt","toUpperCase","ani","apply","open","createUI","then","node","isCloseBeforeShow","hide","callback","close","hideAll","key","Object","prototype","call","addHidePopup","includes","push","length","i","len","hidePath","splice","pushToPopupSeq","param","callBack","popupDialog","isShow","_checkPopupSeq","insertToPopupSeq","index","shiftFromPopupSeq","shift","first","showTips","content","type","targetPos","scale","str","String","next","_showTipsAni","now","Date","spareTime","setTimeout"],"mappings":"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","sourcesContent":["import { _decorator, Node, find, isValid, Vec3, CameraComponent } from \"cc\";\r\nimport { Constants } from \"../Constants\";\r\nimport { ResourcesUtil } from \"./ResourcesUtil\";\r\n// import { PoolManager } from \"./poolManager\";\r\n// import { tips } from \"../ui/common/tips\";\r\nconst { ccclass, property } = _decorator;\r\n\r\nlet SHOW_STR_INTERVAL_TIME = 800;\r\n@ccclass(\"PopupManager\")\r\nexport class PopupManager {\r\n    private _dictSharedPanel: any = {}//存在的弹窗界面\r\n    private _dictLoading: any = {}//加载状态控制\r\n    private _arrPopupDialog: any = [] //队列中的弹窗\r\n    private _hidePopupArr: Array<string> = [];//打开下一个窗口时，需要被动关闭之前的弹窗\r\n    private _showTipsTime: number = 0\r\n\r\n    private static _instance: PopupManager;\r\n\r\n    public static get instance() {\r\n        if (this._instance) {\r\n            return this._instance;\r\n        }\r\n\r\n        this._instance = new PopupManager();\r\n        return this._instance;\r\n    }\r\n\r\n    /**\r\n     * 检查当前界面是否正在展示\r\n     * @param panelPath \r\n     */\r\n    public isDialogVisible(panelPath: string) {\r\n        if (!this._dictSharedPanel.hasOwnProperty(panelPath)) {\r\n            return false;\r\n        }\r\n\r\n        let panel = this._dictSharedPanel[panelPath];\r\n\r\n        return isValid(panel) && panel.active && isValid(panel.parent);\r\n    }\r\n\r\n\r\n    /**\r\n     * 显示单例界面\r\n     * @param {PopupOptions} options \r\n     * @param {Array} args \r\n     * @param {Function} cb 回调函数，创建完毕后回调\r\n     */\r\n    public show(options: PopupOptions, args?: any, cb?: Function) {\r\n        let panelPath = options.path;\r\n        if (this._dictLoading[panelPath]) {\r\n            return;\r\n        }\r\n        //是否关闭添加的弹窗队列\r\n        options.closeCur && this.hideJoinPopup(panelPath);\r\n        let idxSplit = panelPath.lastIndexOf('/');\r\n        let scriptName = panelPath.slice(idxSplit + 1);\r\n\r\n        if (!args) {\r\n            args = [];\r\n        }\r\n\r\n        if (this._dictSharedPanel.hasOwnProperty(panelPath)) {\r\n            let panel = this._dictSharedPanel[panelPath];\r\n            if (isValid(panel)) {\r\n                panel.parent = options.parent ?? find(\"Canvas\");\r\n                panel.active = true;\r\n                let script = panel.getComponent(scriptName);\r\n                let script2 = panel.getComponent(scriptName.charAt(0).toUpperCase() + scriptName.slice(1));\r\n                let ani = panel.getComponent('animationUI');\r\n                if (script && script.show) {\r\n                    script.show.apply(script, args);\r\n                    if (ani) {\r\n                        ani.open(() => {\r\n                            cb && cb(script);\r\n                        })\r\n                    }\r\n                    else {\r\n                        cb && cb(script);\r\n                    }\r\n                } else if (script2 && script2.show) {\r\n                    script2.show.apply(script2, args);\r\n                    if (ani) {\r\n                        ani.open(() => {\r\n                            cb && cb(script2);\r\n                        })\r\n                    }\r\n                    else {\r\n                        cb && cb(script2);\r\n                    }\r\n                } else {\r\n                    throw `查找不到脚本文件${scriptName}`;\r\n                }\r\n\r\n                return;\r\n            }\r\n        }\r\n\r\n        this._dictLoading[panelPath] = true;\r\n        ResourcesUtil.createUI(panelPath, options.parent).then((node: Node) => {\r\n            //判断是否有可能在显示前已经被关掉了？\r\n            let isCloseBeforeShow = false;\r\n            if (!this._dictLoading[panelPath]) {\r\n                //已经被关掉\r\n                isCloseBeforeShow = true;\r\n            }\r\n            this._dictLoading[panelPath] = false;\r\n\r\n\r\n            this._dictSharedPanel[panelPath] = node;\r\n            let ani: any = node.getComponent('animationUI');\r\n            let script: any = node.getComponent(scriptName);\r\n            let script2: any = node.getComponent(scriptName.charAt(0).toUpperCase() + scriptName.slice(1));\r\n            if (script && script.show) {\r\n                script.show.apply(script, args);\r\n                if (ani) {\r\n                    ani.open(() => {\r\n                        cb && cb(script);\r\n                    })\r\n                }\r\n                else {\r\n                    cb && cb(script);\r\n                }\r\n            } else if (script2 && script2.show) {\r\n                script2.show.apply(script2, args);\r\n                if (ani) {\r\n                    ani.open(() => {\r\n                        cb && cb(script2);\r\n                    })\r\n                }\r\n                else {\r\n                    cb && cb(script2);\r\n                }\r\n            } else {\r\n                throw `查找不到脚本文件${scriptName} 或 未定义show方法`;\r\n            }\r\n\r\n            if (isCloseBeforeShow) {\r\n                //如果在显示前又被关闭，则直接触发关闭掉\r\n                this.hide(panelPath);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 隐藏单例界面\r\n     * @param {String} panelPath \r\n     * @param {fn} callback\r\n     */\r\n    public hide(panelPath: string, callback?: Function) {\r\n        if (this._dictSharedPanel.hasOwnProperty(panelPath)) {\r\n            let panel = this._dictSharedPanel[panelPath];\r\n            if (panel && isValid(panel)) {\r\n                let ani = panel.getComponent('animationUI');\r\n                if (ani) {\r\n                    ani.close(() => {\r\n                        panel.parent = null;\r\n                        if (callback && typeof callback === 'function') {\r\n                            callback();\r\n                        }\r\n                    });\r\n                } else {\r\n                    panel.parent = null;\r\n                    if (callback && typeof callback === 'function') {\r\n                        callback();\r\n                    }\r\n                }\r\n            } else if (callback && typeof callback === 'function') {\r\n                callback();\r\n            }\r\n        }\r\n\r\n        this._dictLoading[panelPath] = false;\r\n    }\r\n\r\n    public hideAll() {\r\n        for (const key in this._dictSharedPanel) {\r\n            if (Object.prototype.hasOwnProperty.call(this._dictSharedPanel, key)) {\r\n                const panel = this._dictSharedPanel[key];\r\n                panel.parent = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加需要被动关闭的弹窗\r\n     * @param panelPath \r\n     */\r\n    public addHidePopup(panelPath: string) {\r\n        if (!this._hidePopupArr.includes(panelPath)) {\r\n            this._hidePopupArr.push(panelPath);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 关闭加入的隐藏弹窗\r\n     */\r\n    public hideJoinPopup(panelPath: string) {\r\n        if (this._hidePopupArr.length) {\r\n            for (let i = 0, len = this._hidePopupArr.length; i < len; i++) {\r\n                let hidePath = this._hidePopupArr[i];\r\n                if (hidePath != panelPath) {\r\n                    this.hide(hidePath);\r\n                    this._hidePopupArr.splice(i, 1);\r\n                    i--;\r\n                    len--;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 将弹窗加入弹出窗队列\r\n     * @param options \r\n     * @param param \r\n     */\r\n    public pushToPopupSeq(options: PopupOptions, param?: any, callBack?: Function) {\r\n        let popupDialog = {\r\n            options: options,\r\n            callBack: callBack,\r\n            param: param,\r\n            isShow: false\r\n        };\r\n        this._arrPopupDialog.push(popupDialog);\r\n        this._checkPopupSeq();\r\n    }\r\n\r\n    /**\r\n     * 将弹窗加入弹出窗队列\r\n     * @param {number} index \r\n     * @param {string} panelPath \r\n     * @param {*} param \r\n     */\r\n    public insertToPopupSeq(index: number, options: PopupOptions, param?: any, callBack?: Function) {\r\n        let popupDialog = {\r\n            options: options,\r\n            callBack: callBack,\r\n            param: param,\r\n            isShow: false\r\n        };\r\n\r\n        this._arrPopupDialog.splice(index, 0, popupDialog);\r\n    }\r\n\r\n    /**\r\n     * 将弹窗从弹出窗队列中移除\r\n     * @param {string} panelPath \r\n     */\r\n    public shiftFromPopupSeq(panelPath: string, callBack?: Function) {\r\n        //检测是否为队列弹窗\r\n        if (this._arrPopupDialog[0] && this._arrPopupDialog[0].options.path === panelPath) {\r\n            this.hide(panelPath, () => {\r\n                this._arrPopupDialog.shift();\r\n                this._checkPopupSeq();\r\n            })\r\n        }\r\n        else {\r\n            this.hide(panelPath, callBack)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 检查当前是否需要弹窗\r\n     */\r\n    private _checkPopupSeq() {\r\n        if (this._arrPopupDialog.length > 0) {\r\n            let first = this._arrPopupDialog[0];\r\n\r\n            if (!first.isShow) {\r\n                this.show(first.options, first.param, first.callBack);\r\n                this._arrPopupDialog[0].isShow = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 显示提示\r\n     * @param {String} content \r\n     * @param {Function} cb \r\n     */\r\n    public showTips(content: string | number, type: string = 'txt', targetPos: Vec3 = new Vec3(), scale: number = 1, callback: Function = () => { }) {\r\n        let str = String(content);\r\n        let next = () => {\r\n            this._showTipsAni(str, type, targetPos, scale, callback);\r\n        }\r\n        var now = Date.now();\r\n        if (now - this._showTipsTime < SHOW_STR_INTERVAL_TIME && type !== 'gold' && type !== 'heart') {\r\n            var spareTime = SHOW_STR_INTERVAL_TIME - (now - this._showTipsTime);\r\n            setTimeout(() => {\r\n                next();\r\n            }, spareTime);\r\n\r\n            this._showTipsTime = now + spareTime;\r\n        } else {\r\n            next();\r\n            this._showTipsTime = now;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 内部函数\r\n     * @param {String} content \r\n     * @param {Function} cb \r\n     */\r\n    private _showTipsAni(content: string, type: string, targetPos: Vec3, scale: number, callback?: Function) {\r\n        // ResourceUtil.getUIPrefabRes('common/tips').then((prefab: any) => {\r\n        //     let tipsNode = PoolManager.instance.getNode(prefab, find(\"Canvas\") as Node);\r\n\r\n        //     let tipScript = tipsNode.getComponent(tips) as tips;\r\n        //     tipScript.show(content, type, targetPos, scale, callback);\r\n        // });\r\n    }\r\n}\r\n\r\nexport class PopupOptions {\r\n    path: string; //窗口路径\r\n    parent: Node; //父节点\r\n    closeCur: boolean = false;//是否关闭添加的隐藏窗口队列\r\n}\r\n\r\n\r\n"]}