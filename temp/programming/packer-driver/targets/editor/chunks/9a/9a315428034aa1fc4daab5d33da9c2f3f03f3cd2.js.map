{"version":3,"sources":["file:///D:/CODE/cocos_workspace/%E8%83%8C%E5%8C%85%E8%8B%B1%E9%9B%84/assets/Scripts/Scenes/Load.ts"],"names":["_decorator","Component","Node","director","resources","ProgressBar","Label","Constants","AudioManager","CfgMgr","OpenPopupManager","SystemConstantCfg","ccclass","property","Load","_progress","onLoad","initPopupLayer","loadLocalGameConfg","addPersistRootNode","PersistRoot","instance","TopLayer","getChildByName","MidLayer","BottomLayer","ToastLayer","loadDir","ConfigPath","finished","total","item","p","setProgressBar","err","data","i","length","element","setCfgData","name","json","init","initData","convertConstantData","preloadScene","ConstantData","getCfgDataArray","forEach","SysConstant","ConstantName","lbText","string","Math","floor","progressBar","progress","sceneName","completedCount","totalCount","loadScene"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, game, director, screen, view, resources, ProgressBar, Label } from 'cc';\r\nimport { Constants } from '../Constants';\r\nimport { AudioManager } from '../Frame/AudioManager';\r\nimport { CfgMgr } from '../Frame/CfgMgr';\r\nimport { OpenPopupManager } from '../Frame/OpenPopupManager';\r\nimport { SystemConstantCfg } from '../Model/SystemConstantModel';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Load')\r\nexport class Load extends Component {\r\n    @property(ProgressBar)\r\n    progressBar: ProgressBar = null;\r\n    @property(Label)\r\n    lbText: Label = null;\r\n    @property(Node)\r\n    PersistRoot: Node = null;\r\n    private _progress: number = 0;\r\n\r\n    onLoad() {\r\n        this.initPopupLayer();\r\n        //加载配置数据\r\n        this.loadLocalGameConfg();\r\n    }\r\n\r\n    /* 初始化弹窗提示层 */\r\n    initPopupLayer() {\r\n        director.addPersistRootNode(this.PersistRoot);\r\n        OpenPopupManager.instance.TopLayer = this.PersistRoot.getChildByName('Top');\r\n        OpenPopupManager.instance.MidLayer = this.PersistRoot.getChildByName('Middle');\r\n        OpenPopupManager.instance.BottomLayer = this.PersistRoot.getChildByName('Bottom');\r\n        OpenPopupManager.instance.ToastLayer = this.PersistRoot.getChildByName('Toast');\r\n    }\r\n\r\n    /* 从本地加载配置数据 */\r\n    loadLocalGameConfg() {\r\n        resources.loadDir(Constants.ConfigPath, (finished: number, total: number, item: any) => {\r\n            let p = 80 / total;\r\n            this._progress += p;\r\n            this.setProgressBar();\r\n        }, (err: Error | null, data: any[]) => {\r\n            for (let i = 0; i < data.length; i++) {\r\n                const element = data[i];\r\n                CfgMgr.setCfgData(element.name, element.json)\r\n            }\r\n            AudioManager.instance.init();\r\n            this.initData();\r\n        });\r\n    }\r\n\r\n    /* 初始化数据 */\r\n    initData() {\r\n        this.convertConstantData();\r\n        //加载场景\r\n        this.preloadScene();\r\n    }\r\n\r\n    /* 转换系统常量数据配置 */\r\n    convertConstantData() {\r\n        let ConstantData = CfgMgr.getCfgDataArray<SystemConstantCfg>(new SystemConstantCfg());\r\n        ConstantData.forEach((item) => {\r\n            Constants.SysConstant[item.ConstantName] = item;\r\n        });\r\n    }\r\n\r\n    setProgressBar() {\r\n        this.lbText.string = `${Math.floor(this._progress)}%`;\r\n        this.progressBar.progress = this._progress / 100;\r\n    }\r\n\r\n    /* 预加载场景 */\r\n    preloadScene() {\r\n        let sceneName = 'Game';\r\n        director.preloadScene(sceneName, (completedCount: number, totalCount: number) => {\r\n            let p = Math.floor(20 * (completedCount / totalCount));\r\n            if (this._progress < 80 + p) {\r\n                this._progress = 80 + p;\r\n            }\r\n            this.setProgressBar();\r\n        }, () => {\r\n            this._progress = 100;\r\n            this.setProgressBar();\r\n            director.loadScene(sceneName);\r\n        });\r\n    }\r\n}\r\n\r\n\r\n"]}