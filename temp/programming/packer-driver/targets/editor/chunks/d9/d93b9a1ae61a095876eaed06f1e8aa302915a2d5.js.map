{"version":3,"sources":["file:///D:/CODE/cocos_workspace/%E8%83%8C%E5%8C%85%E8%8B%B1%E9%9B%84/assets/Scripts/Game/Data/SkillUpgradeData.ts"],"names":["SkillUpgradeData","SelectObj","CfgMgr","BattleLevelCfg","SkillUpgradeCfg","_BattleLevelData","Map","_unlockUpgradeOptionsPoolData","init","battleLevelArr","getCfgDataArray","i","length","element","set","Level","skillUpgradeData","options_num","selectObj","id","Id","premise","getSkillUpgradeCfgById","getDataById","getBattleLevelByLevel","level","maxExp","has","get","Exp","getUnlockUpgradeOptionsData","Array","from","values","getSelectObjByWeight","temList","list","start","end","index","sum","newList","hasStatus","j","element1","push","random","Math","some","item","idx","getSelectSkillListByWeight","clear","instance","_instance"],"mappings":"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","sourcesContent":["import { CfgMgr } from \"../../Frame/CfgMgr\";\r\nimport { BattleLevelCfg } from \"../../Model/BattleLevelModel\";\r\nimport { SkillUpgradeCfg } from \"../../Model/SkillUpgradeMode\";\r\n\r\nexport class SkillUpgradeData {\r\n    private _BattleLevelData: Map<number, BattleLevelCfg> = new Map(); //战斗经验配置\r\n    private _unlockUpgradeOptionsPoolData: Map<number, SelectObj> = new Map();//解锁技能池数据 (权重大于0的计算)\r\n    init() {\r\n        let battleLevelArr = CfgMgr.getCfgDataArray<BattleLevelCfg>(new BattleLevelCfg());\r\n        for (let i = 0; i < battleLevelArr.length; i++) {\r\n            const element = battleLevelArr[i];\r\n            this._BattleLevelData.set(element.Level, element);\r\n        }\r\n\r\n        let skillUpgradeData = CfgMgr.getCfgDataArray<SkillUpgradeCfg>(new SkillUpgradeCfg());\r\n        for (let i = 0; i < skillUpgradeData.length; i++) {\r\n            const element = skillUpgradeData[i];\r\n            if (element.options_num) {\r\n                let selectObj = new SelectObj();\r\n                selectObj.id = element.Id;\r\n                selectObj.premise = element.premise;\r\n                selectObj.options_num = element.options_num;\r\n                this._unlockUpgradeOptionsPoolData.set(element.Id, selectObj);\r\n            }\r\n        }\r\n    }\r\n\r\n    getSkillUpgradeCfgById(id: number) {\r\n        return CfgMgr.getDataById<SkillUpgradeCfg>(new SkillUpgradeCfg(), id);\r\n    }\r\n\r\n    /**\r\n     * 获取等级经验数据\r\n     * @param level \r\n     */\r\n    getBattleLevelByLevel(level: number) {\r\n        let maxExp = 100;\r\n        if (this._BattleLevelData.has(level)) {\r\n            maxExp = this._BattleLevelData.get(level).Exp;\r\n        }\r\n        return maxExp;\r\n    }\r\n\r\n\r\n    /* 获取解锁数据 */\r\n    getUnlockUpgradeOptionsData() {\r\n        return Array.from(this._unlockUpgradeOptionsPoolData.values());\r\n    }\r\n\r\n\r\n    /**\r\n* 根据权重获取数据\r\n*/\r\n    getSelectObjByWeight(temList: Array<SelectObj>, list: Array<SelectObj>) {\r\n        let start = 0;\r\n        let end = 0;\r\n        let index = 0;\r\n        let sum = 0;\r\n        let newList: Array<SelectObj> = [];\r\n        for (let i = 0; i < temList.length; i++) {\r\n            let element = temList[i];\r\n            //options_num权重大于0的计算\r\n            if (element.options_num) {\r\n                let hasStatus: boolean = false;\r\n                for (let j = 0; j < list.length; j++) {\r\n                    const element1 = list[j];\r\n                    if (element.id == element1.id) {\r\n                        hasStatus = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (!hasStatus) {\r\n                    let element = temList[i];\r\n                    sum += element.options_num;\r\n                    newList.push(element);\r\n                }\r\n            }\r\n        }\r\n        if (newList.length) {\r\n            let random = Math.random() * sum;\r\n            newList.some((item, idx) => {\r\n                end = start + item.options_num;\r\n                if (random >= start && random < end) {\r\n                    index = idx;\r\n                    return true;\r\n                }\r\n                start = end;\r\n            })\r\n            return newList[index];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /* 通过权重获取技能列表 */\r\n    getSelectSkillListByWeight() {\r\n        let list: Array<SelectObj> = [];\r\n        for (let i = 0; i < 3; i++) {\r\n            let element = this.getSelectObjByWeight(this.getUnlockUpgradeOptionsData(), list);\r\n            if (element) {\r\n                list.push(element);\r\n            }\r\n        }\r\n        return list;\r\n    }\r\n\r\n    clear() {\r\n        this._BattleLevelData.clear();\r\n    }\r\n\r\n    private static _instance: SkillUpgradeData = null;\r\n    public static get instance(): SkillUpgradeData {\r\n        if (!this._instance) {\r\n            this._instance = new SkillUpgradeData();\r\n        }\r\n        return this._instance;\r\n    }\r\n}\r\n\r\nexport class SelectObj {\r\n    id: number;//配置id\r\n    premise: Array<number>;//前置技能\r\n    options_num: number;//数量\r\n}\r\n\r\n\r\n"]}